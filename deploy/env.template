# Heimdex Deployment Environment Template
#
# âš ï¸  INSTRUCTIONS FOR DEPLOYMENT:
# 1. Copy this file to your deployment location as '.env'
# 2. Replace all <placeholder> values with your actual configuration
# 3. Generate strong, random values for all passwords and secrets
# 4. Never commit the filled '.env' file to version control
# 5. For cloud deployments, use a secrets manager (GCP Secret Manager, AWS Secrets Manager, etc.)
#
# âœï¸  = MUST CHANGE - Replace with your actual value
# ğŸ“‹ = OPTIONAL - Can keep default or customize based on your setup
# ğŸ”’ = SENSITIVE - Never commit this value

# ============================================================================
# Database Configuration
# ============================================================================
# âœï¸  ğŸ”’ Replace with your actual PostgreSQL credentials
PGUSER=<your-db-username>                    # âœï¸  Database username
PGPASSWORD=<your-db-password>                # âœï¸  ğŸ”’ Strong password (min 16 chars, random)
PGDATABASE=heimdex                           # ğŸ“‹ Database name
PGHOST=pg                                    # âœï¸  Database host (e.g., localhost, IP, or Cloud SQL instance)
PGPORT=5432                                  # ğŸ“‹ Database port

# ============================================================================
# Message Queue & Cache (Redis)
# ============================================================================
# âœï¸  For production, use authenticated Redis URL
# Format: redis://:<password>@<host>:<port>/<db>
REDIS_URL=redis://:<your-redis-password>@redis:6379/0    # âœï¸  ğŸ”’ Redis connection URL

# ============================================================================
# Vector Database (Qdrant)
# ============================================================================
QDRANT_URL=http://qdrant:6333               # âœï¸  Qdrant HTTP endpoint
VECTOR_SIZE=384                              # ğŸ“‹ Must match embedding model dimension

# ============================================================================
# Embedding Model Configuration
# ============================================================================
EMBEDDING_BACKEND=sentence                   # ğŸ“‹ Backend adapter (options: "sentence")
EMBEDDING_MODEL_NAME=minilm-l6-v2           # ğŸ“‹ Model: minilm-l6-v2, mpnet-base, minilm-l12-v2
EMBEDDING_DEVICE=cpu                         # ğŸ“‹ Device: cpu, cuda, cuda:0, mps
EMBEDDING_VALIDATE_ON_STARTUP=true          # ğŸ“‹ Validate VECTOR_SIZE matches model (recommended: true)

# ============================================================================
# Runtime Configuration
# ============================================================================
# âœï¸  Set to your deployment environment
HEIMDEX_ENV=<local|dev|staging|prod>        # âœï¸  REQUIRED: Set to 'prod' for production
WORKER_CONCURRENCY=2                         # ğŸ“‹ Dramatiq worker threads (adjust based on workload)
OUTBOX_DISPATCH_INTERVAL_MS=500             # ğŸ“‹ Outbox polling interval

# ============================================================================
# Dependency Health Checks (Readiness Probes)
# ============================================================================
ENABLE_PG=true                               # ğŸ“‹ Enable PostgreSQL health check
ENABLE_REDIS=true                            # ğŸ“‹ Enable Redis health check
ENABLE_QDRANT=false                          # ğŸ“‹ Enable Qdrant health check
ENABLE_GCS=false                             # ğŸ“‹ Enable GCS health check

# Probe tunables (fine-tune for your infrastructure)
PROBE_TIMEOUT_MS=300                         # ğŸ“‹ Probe timeout (ms)
PROBE_RETRIES=2                              # ğŸ“‹ Retry attempts
PROBE_COOLDOWN_SEC=30                        # ğŸ“‹ Cooldown after failures
PROBE_CACHE_SEC=10                           # ğŸ“‹ Cache successful probes

# ============================================================================
# Authentication & Authorization
# ============================================================================
# âš ï¸  CRITICAL SECURITY SETTINGS - READ CAREFULLY
#
# For PRODUCTION (HEIMDEX_ENV=prod):
#   - MUST use AUTH_PROVIDER=supabase
#   - MUST provide all Supabase JWT configuration below
#   - AUTH_PROVIDER=dev is BLOCKED and will cause startup failure
#
# For LOCAL DEVELOPMENT (HEIMDEX_ENV=local):
#   - Can use AUTH_PROVIDER=dev for simple HS256 tokens
#   - Can use AUTH_PROVIDER=supabase for testing production auth flow
#
# ============================================================================

# âœï¸  REQUIRED: Choose authentication provider
AUTH_PROVIDER=supabase                       # âœï¸  Options: supabase (prod) | dev (local only)

# --- Supabase JWT Configuration (REQUIRED when AUTH_PROVIDER=supabase) ---
# âœï¸  Replace <project-ref> with your Supabase project reference ID
# Example: https://abcdefghijklmnop.supabase.co
SUPABASE_PROJECT_URL=https://<project-ref>.supabase.co                    # âœï¸  Supabase project URL
SUPABASE_JWKS_URL=https://<project-ref>.supabase.co/auth/v1/jwks         # âœï¸  JWKS endpoint for RS256 verification
AUTH_AUDIENCE=heimdex                                                      # âœï¸  Expected JWT 'aud' claim (your app name)
AUTH_ISSUER=https://<project-ref>.supabase.co/auth/v1                     # âœï¸  Expected JWT 'iss' claim

# --- Development Mode (ONLY for HEIMDEX_ENV=local) ---
# âš ï¸  WARNING: The following setting is ONLY for local development
# If AUTH_PROVIDER=dev and HEIMDEX_ENV != local, the application will refuse to start
#
# Uncomment and set ONLY for local development:
# DEV_JWT_SECRET=<your-local-dev-secret>     # ğŸ”’ Symmetric secret for HS256 (local dev only)
